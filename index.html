<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advanced Baseball Simulator</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React & ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- React Router -->
  <script src="https://cdn.jsdelivr.net/npm/react-router-dom@6/umd/react-router-dom.development.js"></script>
  <!-- Recharts -->
  <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <div id="root" class="flex h-screen"></div>

  <script type="text/babel">
  const { useState, useEffect } = React;
  const { BrowserRouter, Routes, Route, NavLink, useNavigate } = ReactRouterDOM;
  const { LineChart, Line, XAxis, YAxis, Tooltip, CartesianGrid, ResponsiveContainer } = Recharts;

  // Utility Models & Engine (unchanged)
  class Player { /* ... same as before ... */ }
  class Team { /* ... same as before ... */ }
  function weightedProb(weights) { /* ... same as before ... */ }
  function simulateAtBat(batter, pitcher, settings) { /* ... same as before ... */ }
  function simulateGame(home, away, settings) { /* ... same as before ... */ }
  function simulateSeason(teams, settings) { /* ... same as before ... */ }
  function computeDerived(team) { /* ... same as before ... */ }
  function loadLeague() { return JSON.parse(localStorage.getItem('league') || 'null'); }
  function saveLeague(data) { localStorage.setItem('league', JSON.stringify(data)); }

  // Navigation
  function Nav() {
    const tabs = [
      { name: 'Simulator', path: '/simulator' },
      { name: 'Roster', path: '/roster' },
      { name: 'Stats', path: '/stats' },
      { name: 'Settings', path: '/settings' }
    ];
    return (
      <aside className="w-64 bg-indigo-600 text-white flex flex-col">
        <div className="p-6 text-2xl font-bold">⚾ Baseball</div>
        <nav className="flex-1">
          {tabs.map(tab => (
            <NavLink
              key={tab.name}
              to={tab.path}
              className={({ isActive }) =>
                `block px-6 py-3 hover:bg-indigo-500 ${isActive ? 'bg-indigo-700' : ''}`
              }
            >
              {tab.name}
            </NavLink>
          ))}
        </nav>
      </aside>
    );
  }

  // Simulator Component
  function Simulator({ teams, settings, setResults }) {
    const [log, setLog] = useState([]);
    const [box, setBox] = useState({});
    const runGame = () => {
      const result = simulateGame(teams[1], teams[0], settings);
      setLog(result.log);
      setBox(result.box);
    };
    const runSeason = () => {
      const season = simulateSeason([...teams], settings).map(computeDerived);
      setResults(season);
    };
    return (
      <div className="p-6 flex flex-col space-y-6 overflow-y-auto">
        <div className="flex space-x-4">
          <button
            onClick={runGame}
            className="bg-indigo-500 text-white px-4 py-2 rounded-lg shadow hover:bg-indigo-600"
          >
            Simulate Game
          </button>
          <button
            onClick={runSeason}
            className="bg-green-500 text-white px-4 py-2 rounded-lg shadow hover:bg-green-600"
          >
            Simulate Season
          </button>
        </div>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div className="bg-white rounded-lg shadow p-4">
            <h2 className="font-semibold mb-2">Box Score</h2>
            <table className="w-full text-sm border-collapse">
              <thead>
                <tr className="bg-gray-100">
                  <th className="border px-2 py-1">Team</th>
                  <th className="border px-2 py-1">R</th>
                  <th className="border px-2 py-1">H</th>
                  <th className="border px-2 py-1">BB</th>
                  <th className="border px-2 py-1">K</th>
                </tr>
              </thead>
              <tbody>
                {teams.map(t => (
                  <tr key={t.id}>
                    <td className="border px-2 py-1">{t.name}</td>
                    <td className="border px-2 py-1">{box[t.id]?.R || 0}</td>
                    <td className="border px-2 py-1">{box[t.id]?.H || 0}</td>
                    <td className="border px-2 py-1">{box[t.id]?.BB || 0}</td>
                    <td className="border px-2 py-1">{box[t.id]?.K || 0}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
          <div className="bg-white rounded-lg shadow p-4 h-64 overflow-y-auto">
            <h2 className="font-semibold mb-2">Game Log</h2>
            <pre className="text-xs leading-tight whitespace-pre-wrap">{log.join('\n')}</pre>
          </div>
        </div>
      </div>
    );
  }

  // Roster Editor, Stats, Settings unchanged except styling adjustments...
  function RosterEditor({ teams, setTeams }) {
    const updateAttr = (ti, pi, attr, stat, e) => {
      const val = Math.min(100, Math.max(0, parseInt(e.target.value) || 0));
      const newTeams = teams.map((t, idx) => {
        if (idx === ti) {
          const updated = { ...t };
          updated.roster = t.roster.map((p, j) => {
            if (j === pi) {
              const copy = { ...p };
              copy[attr] = { ...p[attr], [stat]: val };
              return copy;
            }
            return p;
          });
          return updated;
        }
        return t;
      });
      setTeams(newTeams);
      saveLeague({ teams: newTeams, settings: loadLeague()?.settings });
    };
    return (
      <div className="p-6 grid grid-cols-1 md:grid-cols-2 gap-6 overflow-y-auto">
        {teams.map((team, ti) => (
          <div key={team.id} className="bg-white rounded-lg shadow p-4">
            <h3 className="font-semibold text-lg mb-4">{team.name}</h3>
            <div className="space-y-4">
              {team.roster.map((p, pi) => (
                <div key={p.id} className="border-b pb-2">
                  <div className="font-medium mb-1">{p.name}</div>
                  <div className="flex space-x-3 items-center text-sm">
                    {['contact','power','patience'].map(stat => (
                      <label key={stat} className="flex flex-col items-center">
                        <span className="text-xs uppercase">{stat}</span>
                        <input
                          type="number"
                          value={p.batting[stat]}
                          onChange={e => updateAttr(ti, pi, 'batting', stat, e)}
                          className="w-16 p-1 border rounded text-center"
                        />
                      </label>
                    ))}
                  </div>
                </div>
              ))}
            </div>
          </div>
        ))}
      </div>
    );
  }

  function Stats({ results }) {
    const data = results;
    return (
      <div className="p-6 space-y-8 overflow-y-auto">
        <div className="bg-white rounded-lg shadow p-4">
          <h3 className="font-semibold mb-2">Standings & Pythagorean Win %</h3>
          <table className="w-full text-sm border-collapse">
            <thead><tr className="bg-gray-100"><th className="border p-1">Team</th><th className="border p-1">W</th><th className="border p-1">L</th><th className="border p-1">Pyth%</th></tr></thead>
            <tbody>
              {data.sort((a,b)=>b.W-a.W).map(t => (
                <tr key={t.name}>
                  <td className="border p-1">{t.name}</td>
                  <td className="border p-1">{t.W}</td>
                  <td className="border p-1">{t.L}</td>
                  <td className="border p-1">{(t.Pyth*100).toFixed(1)}%</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
        <div className="bg-white rounded-lg shadow p-4" style={{ height: 300 }}>
          <ResponsiveContainer width="100%" height="100%">
            <LineChart data={data} margin={{ top: 20, right: 30, left: 0, bottom: 0 }}>
              <XAxis dataKey="name" />
              <YAxis />
              <Tooltip />
              <CartesianGrid strokeDasharray="3 3" />
              <Line type="monotone" dataKey="RS" name="Runs Scored" />
              <Line type="monotone" dataKey="RA" name="Runs Allowed" />
            </LineChart>
          </ResponsiveContainer>
        </div>
      </div>
    );
  }

  function Settings({ settings, setSettings }) {
    const change = (k, v) => {
      const newSettings = { ...settings, [k]: v };
      setSettings(newSettings);
      saveLeague({ teams: loadLeague()?.teams, settings: newSettings });
    };
    return (
      <div className="p-6 space-y-6 overflow-y-auto max-w-md">
        <div className="bg-white rounded-lg shadow p-4">
          <label className="block mb-2">
            <span className="font-medium">Ballpark Offense Factor: {settings.offense.toFixed(2)}</span>
            <input
              type="range"
              min="0.5"
              max="1.5"
              step="0.01"
              value={settings.offense}
              onChange={e => change('offense', +e.target.value)}
              className="w-full mt-2"
            />
          </label>
          <label className="block">
            <span className="font-medium">Ballpark Defense Factor: {settings.defense.toFixed(2)}</span>
            <input
              type="range"
              min="0.5"
              max="1.5"
              step="0.01"
              value={settings.defense}
              onChange={e => change('defense', +e.target.value)}
              className="w-full mt-2"
            />
          </label>
        </div>
      </div>
    );
  }

  function App() {
    const saved = loadLeague();
    const [teams, setTeams] = useState(saved?.teams || [new Team('T1','Home'), new Team('T2','Away')]);
    const [settings, setSettings] = useState(saved?.settings || { offense: 1, defense: 1 });
    const [results, setResults] = useState([]);
    useEffect(() => saveLeague({ teams, settings }), [teams, settings]);

    return (
      <BrowserRouter>
        <div className="flex h-full">
          <Nav />
          <main className="flex-1 overflow-hidden">
            <Routes>
              <Route path="/" element={<Simulator teams={teams} settings={settings} setResults={setResults} />} />
              <Route path="/simulator" element={<Simulator teams={teams} settings={settings} setResults={setResults} />} />
              <Route path="/roster" element={<RosterEditor teams={teams} setTeams={setTeams} />} />
              <Route path="/stats" element={<Stats results={results} />} />
              <Route path="/settings" element={<Settings settings={settings} setSettings={setSettings} />} />
            </Routes>
          </main>
        </div>
      </BrowserRouter>
    );
  }

  ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
