<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Stellar Colony</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0a0f1c 0%, #1a1f3a 50%, #2d1b69 100%);
      color: #e0e6ed;
      min-height: 100vh;
      overflow-x: hidden;
    }
    .header {
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      padding: 1rem;
      border-bottom: 2px solid #4a90e2;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .header h1 {
      text-align: center;
      font-size: 2rem;
      background: linear-gradient(45deg, #4a90e2, #7b68ee, #ff6b9d);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 10px rgba(74, 144, 226, 0.5);
    }
    .game-container {
      display: grid;
      grid-template-columns: 1fr 350px;
      gap: 1rem;
      padding: 1rem;
      max-width: 1400px;
      margin: 0 auto;
    }
    .main-panel {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(15px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 1.5rem;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }
    .side-panel {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .panel {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(15px);
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 1rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }
    .panel:hover {
      border-color: rgba(74, 144, 226, 0.5);
      box-shadow: 0 12px 40px rgba(74, 144, 226, 0.1);
    }
    .panel h3 {
      color: #4a90e2;
      margin-bottom: 0.75rem;
      font-size: 1.2rem;
      text-align: center;
    }
    .resources {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
    }
    .resource {
      background: rgba(255, 255, 255, 0.05);
      padding: 0.6rem;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    .resource::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(74, 144, 226, 0.1), transparent);
      transition: left 0.5s ease;
    }
    .resource:hover::before {
      left: 100%;
    }
    .resource-name {
      font-size: 0.8rem;
      color: #b0b8c1;
      margin-bottom: 0.25rem;
    }
    .resource-value {
      font-size: 1.2rem;
      font-weight: bold;
      color: #4a90e2;
    }
    .colony-view {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    .colony-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }
    .stat-card {
      background: rgba(255, 255, 255, 0.05);
      padding: 1rem;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
      transition: all 0.3s ease;
    }
    .stat-card:hover {
      transform: translateY(-4px);
      border-color: rgba(74, 144, 226, 0.5);
      box-shadow: 0 12px 28px rgba(74, 144, 226, 0.1);
    }
    .stat-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: #4a90e2;
      display: block;
    }
    .stat-label {
      color: #b0b8c1;
      font-size: 0.8rem;
      margin-top: 0.4rem;
    }
    .buildings {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 0.75rem;
    }
    .building-wrapper {
      position: relative;
    }
    .building {
      background: rgba(255, 255, 255, 0.05);
      padding: 1.2rem;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    .building:hover {
      transform: translateY(-4px);
      border-color: rgba(74, 144, 226, 0.5);
      box-shadow: 0 12px 28px rgba(74, 144, 226, 0.2);
    }
    .building::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #4a90e2, #7b68ee);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }
    .building:hover::before {
      transform: scaleX(1);
    }
    .building h4 {
      color: #4a90e2;
      margin-bottom: 0.4rem;
      font-size: 1rem;
    }
    .building-count {
      font-size: 1.2rem;
      font-weight: bold;
      color: #7b68ee;
      margin: 0.4rem 0;
    }
    .building-cost {
      font-size: 0.75rem;
      color: #b0b8c1;
      margin-bottom: 0.6rem;
    }
    .tooltip {
      position: absolute;
      bottom: 110%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      padding: 0.6rem;
      border-radius: 6px;
      font-size: 0.75rem;
      text-align: left;
      width: 220px;
      z-index: 10;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease, visibility 0.2s ease;
    }
    .building-wrapper:hover .tooltip {
      opacity: 1;
      visibility: visible;
    }
    .btn {
      background: linear-gradient(45deg, #4a90e2, #7b68ee);
      color: white;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 20px;
      cursor: pointer;
      font-weight: bold;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      width: 100%;
      max-width: 140px;
    }
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }
    .btn:hover::before {
      left: 100%;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(74, 144, 226, 0.3);
    }
    .btn:disabled {
      background: #555;
      cursor: not-allowed;
      transform: none;
    }
    .research-tree {
      max-height: 350px;
      overflow-y: auto;
    }
    .research-wrapper {
      position: relative;
    }
    .research-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 0.8rem;
      margin-bottom: 0.4rem;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
      position: relative;
    }
    .research-item:hover {
      border-color: rgba(74, 144, 226, 0.5);
    }
    .research-item.completed {
      border-color: #4caf50;
      background: rgba(76, 175, 80, 0.1);
    }
    .research-item.researching {
      border-color: #ff9800;
      background: rgba(255, 152, 0, 0.1);
    }
    .research-wrapper:hover .tooltip {
      opacity: 1;
      visibility: visible;
    }
    .progress-bar {
      width: 100%;
      height: 5px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 0.4rem;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4a90e2, #7b68ee);
      transition: width 0.4s ease;
    }
    .notification {
      position: fixed;
      top: 80px;
      right: 10px;
      background: rgba(74, 144, 226, 0.9);
      padding: 0.8rem;
      border-radius: 8px;
      color: white;
      font-weight: bold;
      font-size: 0.9rem;
      transform: translateX(300px);
      transition: transform 0.4s ease;
      z-index: 1000;
      max-width: 200px;
    }
    .notification.show {
      transform: translateX(0);
    }
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.7;
      }
    }
    .pulsing {
      animation: pulse 2s infinite;
    }
    .tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    .tab {
      flex: 1;
      padding: 0.5rem 0.5rem;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 10px;
      color: #b0b8c1;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }
    .tab.active {
      background: linear-gradient(45deg, #4a90e2, #7b68ee);
      color: white;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    ::-webkit-scrollbar {
      width: 6px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(45deg, #4a90e2, #7b68ee);
      border-radius: 4px;
    }

    @media (max-width: 768px) {
      .game-container {
        grid-template-columns: 1fr;
        padding: 0.5rem;
      }
      .main-panel {
        padding: 1rem;
      }
      .side-panel {
        flex-direction: column;
      }
      .panel {
        padding: 0.8rem;
      }
      .colony-view h2 {
        font-size: 1.5rem;
      }
      .colony-stats {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }
      .stat-card {
        padding: 0.8rem;
      }
      .stat-value {
        font-size: 1.2rem;
      }
      .stat-label {
        font-size: 0.7rem;
      }
      .tabs {
        flex-wrap: wrap;
      }
      .tab {
        font-size: 0.85rem;
        padding: 0.4rem;
      }
      .buildings {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }
      .building {
        padding: 0.8rem;
      }
      .building h4 {
        font-size: 0.95rem;
      }
      .building-count {
        font-size: 1.1rem;
      }
      .building-cost {
        font-size: 0.7rem;
      }
      .btn {
        padding: 0.5rem 0.8rem;
        font-size: 0.85rem;
        max-width: 100%;
      }
      .resources {
        grid-template-columns: 1fr;
        gap: 0.4rem;
      }
      .resource {
        padding: 0.5rem;
      }
      .resource-name {
        font-size: 0.75rem;
      }
      .resource-value {
        font-size: 1rem;
      }
      .research-tree {
        max-height: 300px;
      }
      .research-item {
        padding: 0.6rem;
        font-size: 0.85rem;
      }
      .progress-bar {
        height: 4px;
      }
      .notification {
        top: 60px;
        right: 5px;
        font-size: 0.85rem;
        max-width: 180px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>🚀 STELLAR COLONY 🌟</h1>
  </div>

  <div class="game-container">
    <div class="main-panel">
      <div class="colony-view">
        <h2>Colony Overview</h2>
        <div class="colony-stats">
          <div class="stat-card">
            <span class="stat-value" id="population">5</span>
            <div class="stat-label">Population</div>
          </div>
          <div class="stat-card">
            <span class="stat-value" id="happiness">100</span>
            <div class="stat-label">Happiness %</div>
          </div>
          <div class="stat-card">
            <span class="stat-value" id="efficiency">100</span>
            <div class="stat-label">Efficiency %</div>
          </div>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" onclick="switchTab.call(this, 'buildings')">Buildings</button>
        <button class="tab" onclick="switchTab.call(this, 'research')">Research</button>
      </div>

      <div id="buildings-tab" class="tab-content active">
        <h3>Colony Buildings</h3>
        <div class="buildings" id="buildings-container"></div>
      </div>

      <div id="research-tab" class="tab-content">
        <h3>Research Tree</h3>
        <div class="research-tree" id="research-container"></div>
      </div>
    </div>

    <div class="side-panel">
      <div class="panel">
        <h3>Resources</h3>
        <div class="resources" id="resources-container"></div>
      </div>
      <div class="panel">
        <h3>Production Rate</h3>
        <div id="production-rates"></div>
      </div>
      <div class="panel">
        <h3>Colony Status</h3>
        <div id="colony-status">
          <p>Day: <span id="day-counter">1</span></p>
          <p>Colony Level: <span id="colony-level">1</span></p>
          <p>Total Buildings: <span id="total-buildings">0</span></p>
        </div>
      </div>
    </div>
  </div>

  <div class="notification" id="notification"></div>

  <script>
    class StellarColony {
      constructor() {
        this.resources = {
          energy: 100,
          minerals: 50,
          population: 5,
          research: 0,
          food: 20,
          water: 30
        };

        this.buildings = {
          'Solar Panel': {
            count: 0,
            cost: { energy: 0, minerals: 10 },
            production: { energy: 5 },
            requires: null,
            description: 'Generates 5 energy per minute. Cost: 10 minerals.'
          },
          'Mining Station': {
            count: 0,
            cost: { energy: 15, minerals: 0 },
            production: { minerals: 3 },
            requires: null,
            description: 'Produces 3 minerals per minute. Cost: 15 energy.'
          },
          'Hydroponic Farm': {
            count: 0,
            cost: { energy: 20, minerals: 15 },
            production: { food: 8 },
            requires: null,
            description: 'Yields 8 food per minute. Cost: 20 energy, 15 minerals.'
          },
          'Water Recycler': {
            count: 0,
            cost: { energy: 25, minerals: 20 },
            production: { water: 6 },
            requires: null,
            description: 'Generates 6 water per minute. Cost: 25 energy, 20 minerals.'
          },
          'Residential Pod': {
            count: 0,
            cost: { energy: 30, minerals: 25, food: 10 },
            production: { population: 2 },
            requires: null,
            description: 'Increases population by 2 per minute. Cost: 30 energy, 25 minerals, 10 food.'
          },
          'Research Lab': {
            count: 0,
            cost: { energy: 40, minerals: 30, water: 15 },
            production: { research: 2 },
            requires: null,
            description: 'Produces 2 research points per minute. Cost: 40 energy, 30 minerals, 15 water.'
          },
          'Fusion Reactor': {
            count: 0,
            cost: { energy: 0, minerals: 100, research: 50 },
            production: { energy: 25 },
            requires: 'Advanced Energy',
            description: 'Generates 25 energy per minute. Cost: 100 minerals, 50 research. Requires Advanced Energy.'
          },
          'Quantum Computer': {
            count: 0,
            cost: { energy: 60, minerals: 80, research: 100 },
            production: { research: 10 },
            requires: 'Quantum Physics',
            description: 'Produces 10 research per minute. Cost: 60 energy, 80 minerals, 100 research. Requires Quantum Physics.'
          },
          'Biodome': {
            count: 0,
            cost: { energy: 80, minerals: 60, water: 40, food: 20 },
            production: { food: 20, population: 3 },
            requires: 'Ecosystem Management',
            description: 'Yields 20 food and +3 population per minute. Cost: 80 energy, 60 minerals, 40 water, 20 food. Requires Ecosystem Management.'
          }
        };

        this.research = {
          'Advanced Energy': {
            cost: 25,
            completed: false,
            researching: false,
            progress: 0,
            unlocks: ['Fusion Reactor'],
            effect: null,
            description: 'Unlocks Fusion Reactor. Cost: 25 research points.'
          },
          'Quantum Physics': {
            cost: 75,
            completed: false,
            researching: false,
            progress: 0,
            unlocks: ['Quantum Computer'],
            effect: null,
            description: 'Unlocks Quantum Computer. Cost: 75 research points.'
          },
          'Ecosystem Management': {
            cost: 50,
            completed: false,
            researching: false,
            progress: 0,
            unlocks: ['Biodome'],
            effect: null,
            description: 'Unlocks Biodome. Cost: 50 research points.'
          },
          'Space Mining': {
            cost: 40,
            completed: false,
            researching: false,
            progress: 0,
            unlocks: null,
            effect: 'Double mineral production',
            description: 'Doubles all mineral production. Cost: 40 research points.'
          },
          'Hydroponics Tech': {
            cost: 35,
            completed: false,
            researching: false,
            progress: 0,
            unlocks: null,
            effect: 'Food production +50%',
            description: 'Increases food production by 50%. Cost: 35 research points.'
          },
          'Population Growth': {
            cost: 60,
            completed: false,
            researching: false,
            progress: 0,
            unlocks: null,
            effect: 'Population growth +100%',
            description: 'Doubles population generation. Cost: 60 research points.'
          }
        };

        this.gameStats = {
          day: 1,
          happiness: 100,
          efficiency: 100,
          colonyLevel: 1,
          totalBuildings: 0
        };

        this.productionMultipliers = {
          energy: 1,
          minerals: 1,
          food: 1,
          water: 1,
          research: 1,
          population: 1
        };

        this.currentResearch = null;
        this.init();
      }

      init() {
        this.updateDisplay();
        this.renderBuildings();
        this.renderResearch();
        this.startGameLoop();
      }

      updateDisplay() {
        // Update resources
        const resourcesContainer = document.getElementById('resources-container');
        resourcesContainer.innerHTML = '';
        Object.entries(this.resources).forEach(([resource, amount]) => {
          const resourceDiv = document.createElement('div');
          resourceDiv.className = 'resource';
          resourceDiv.innerHTML = `
            <div class="resource-name">${resource.charAt(0).toUpperCase() + resource.slice(1)}</div>
            <div class="resource-value">${Math.floor(amount)}</div>
          `;
          resourcesContainer.appendChild(resourceDiv);
        });

        // Update production rates
        const productionContainer = document.getElementById('production-rates');
        productionContainer.innerHTML = '';
        const productionRates = this.calculateProductionRates();
        Object.entries(productionRates).forEach(([resource, rate]) => {
          if (Math.abs(rate) > 0.001) {
            const rateDiv = document.createElement('div');
            rateDiv.style.cssText = 'margin-bottom: 0.5rem; padding: 0.5rem; background: rgba(255,255,255,0.05); border-radius: 8px;';
            rateDiv.innerHTML = `
              ${resource}: <span style="color: ${rate > 0 ? '#4caf50' : '#f44336'};">${rate > 0 ? '+' : ''}${rate.toFixed(1)}/min</span>
            `;
            productionContainer.appendChild(rateDiv);
          }
        });

        // Update colony stats
        document.getElementById('population').textContent = Math.floor(this.resources.population);
        document.getElementById('happiness').textContent = Math.floor(this.gameStats.happiness);
        document.getElementById('efficiency').textContent = Math.floor(this.gameStats.efficiency);
        document.getElementById('day-counter').textContent = Math.floor(this.gameStats.day);
        document.getElementById('colony-level').textContent = this.gameStats.colonyLevel;
        document.getElementById('total-buildings').textContent = this.gameStats.totalBuildings;
      }

      calculateProductionRates() {
        // Rates are per minute
        const rates = {
          energy: 0,
          minerals: 0,
          food: 0,
          water: 0,
          research: 0,
          population: 0
        };

        Object.entries(this.buildings).forEach(([name, building]) => {
          if (building.count > 0 && building.production) {
            Object.entries(building.production).forEach(([resource, amountPerMinute]) => {
              const perMinute = amountPerMinute * building.count * this.productionMultipliers[resource] * (this.gameStats.efficiency / 100);
              rates[resource] += perMinute;
            });
          }
        });

        // Consumption per minute
        rates.energy -= this.resources.population * 0.5;
        rates.food -= this.resources.population * 0.3;
        rates.water -= this.resources.population * 0.2;

        return rates;
      }

      renderBuildings() {
        const container = document.getElementById('buildings-container');
        container.innerHTML = '';
        Object.entries(this.buildings).forEach(([name, building]) => {
          const wrapper = document.createElement('div');
          wrapper.className = 'building-wrapper';

          const buildingDiv = document.createElement('div');
          buildingDiv.className = 'building';

          const isUnlocked = !building.requires || this.research[building.requires]?.completed;
          const canAfford = this.canAffordBuilding(name);

          let innerHTML = `
            <h4>${name}</h4>
            <div class="building-count">${building.count}</div>
            <div class="building-cost">${this.formatCost(building.cost)}</div>
          `;

          if (!isUnlocked) {
            innerHTML += `
              <div style="color: #ff9800; font-size: 0.75rem; margin: 0.4rem 0;">Requires: ${building.requires}</div>
              <button class="btn disabled" disabled>Locked</button>
            `;
          } else {
            innerHTML += `
              <button class="btn ${canAfford ? '' : 'disabled'}" onclick="game.buildBuilding('${name}')" ${!canAfford ? 'disabled' : ''}> Build </button>
            `;
          }
          buildingDiv.innerHTML = innerHTML;

          // Tooltip
          const tooltip = document.createElement('div');
          tooltip.className = 'tooltip';
          tooltip.textContent = building.description;

          wrapper.appendChild(buildingDiv);
          wrapper.appendChild(tooltip);
          container.appendChild(wrapper);
        });
      }

      renderResearch() {
        const container = document.getElementById('research-container');
        container.innerHTML = '';
        Object.entries(this.research).forEach(([name, tech]) => {
          const wrapper = document.createElement('div');
          wrapper.className = 'research-wrapper';

          const researchDiv = document.createElement('div');
          researchDiv.className = `research-item ${tech.completed ? 'completed' : ''} ${tech.researching ? 'researching' : ''}`;

          const canResearch = this.resources.research >= tech.cost && !tech.completed && !tech.researching && !this.currentResearch;

          let innerHTML = `
            <h4>${name}</h4>
            <p style="font-size: 0.9rem;">Cost: ${tech.cost} Research</p>
          `;

          if (tech.unlocks) {
            innerHTML += `<p style="color: #4caf50; font-size: 0.85rem;">Unlocks: ${tech.unlocks.join(', ')}</p>`;
          }
          if (tech.effect) {
            innerHTML += `<p style="color: #ff9800; font-size: 0.85rem;">Effect: ${tech.effect}</p>`;
          }
          if (tech.researching) {
            innerHTML += `<div class="progress-bar"><div class="progress-fill" style="width: ${(tech.progress / tech.cost) * 100}%"></div></div>`;
          }
          if (!tech.completed && !tech.researching) {
            innerHTML += `<button class="btn ${canResearch ? '' : 'disabled'}" onclick="game.startResearch('${name}')" ${!canResearch ? 'disabled' : ''}>Research</button>`;
          }
          if (tech.completed) {
            innerHTML += '<p style="color: #4caf50; font-weight: bold; font-size: 0.9rem;">✓ Completed</p>';
          }
          researchDiv.innerHTML = innerHTML;

          // Tooltip
          const tooltip = document.createElement('div');
          tooltip.className = 'tooltip';
          tooltip.textContent = tech.description;

          wrapper.appendChild(researchDiv);
          wrapper.appendChild(tooltip);
          container.appendChild(wrapper);
        });
      }

      canAffordBuilding(name) {
        const cost = this.buildings[name].cost;
        return Object.entries(cost).every(
          ([resource, amount]) => Math.floor(this.resources[resource]) >= amount
        );
      }

      buildBuilding(name) {
        const building = this.buildings[name];
        const isUnlocked = !building.requires || this.research[building.requires]?.completed;
        if (!isUnlocked) {
          this.showNotification(`${name} requires ${building.requires} research!`);
          return;
        }
        if (!this.canAffordBuilding(name)) {
          this.showNotification(`Not enough resources for ${name}!`);
          return;
        }
        const cost = building.cost;
        Object.entries(cost).forEach(([resource, amount]) => {
          this.resources[resource] -= amount;
        });
        building.count++;
        this.gameStats.totalBuildings++;
        this.showNotification(`Built ${name}!`);
        this.renderBuildings();
        this.updateColonyLevel();
        this.updateDisplay();
      }

      startResearch(name) {
        if (this.currentResearch || this.research[name].completed || this.research[name].researching) return;
        const tech = this.research[name];
        if (this.resources.research < tech.cost) return;
        tech.researching = true;
        tech.progress = 0;
        this.currentResearch = name;
        this.showNotification(`Started researching ${name}!`);
        this.renderResearch();
        this.updateDisplay();
      }

      formatCost(cost) {
        return Object.entries(cost).map(([resource, amount]) => `${amount} ${resource}`).join(', ');
      }

      updateColonyLevel() {
        const newLevel = Math.floor(this.gameStats.totalBuildings / 5) + 1;
        if (newLevel > this.gameStats.colonyLevel) {
          this.gameStats.colonyLevel = newLevel;
          this.showNotification(`Colony Level Up! Now level ${newLevel}`);
        }
      }

      updateGameStats() {
        const foodRatio = this.resources.food / Math.max(this.resources.population, 1);
        const waterRatio = this.resources.water / Math.max(this.resources.population, 1);
        this.gameStats.happiness = Math.max(
          20,
          Math.min(
            100,
            50 + (foodRatio * 10) + (waterRatio * 15) + (this.resources.energy > 0 ? 25 : -25)
          )
        );
        this.gameStats.efficiency = Math.max(
          25,
          Math.min(
            150,
            this.gameStats.happiness + (this.resources.energy > 0 ? 0 : -50)
          )
        );
      }

      applyResearchEffects() {
        this.productionMultipliers = {
          energy: 1,
          minerals: 1,
          food: 1,
          water: 1,
          research: 1,
          population: 1
        };
        if (this.research['Space Mining'].completed) {
          this.productionMultipliers.minerals = 2;
        }
        if (this.research['Hydroponics Tech'].completed) {
          this.productionMultipliers.food = 1.5;
        }
        if (this.research['Population Growth'].completed) {
          this.productionMultipliers.population = 2;
        }
      }

      gameLoop() {
        const rates = this.calculateProductionRates();
        Object.entries(rates).forEach(([resource, rate]) => {
          if (resource === 'population') {
            this.resources[resource] += rate / 60; // population per-minute → per-second
          } else {
            this.resources[resource] += rate / 6; // per-minute → per-second
          }
        });

        // Clamp non-energy resources to ≥ 0
        ['minerals', 'food', 'water', 'research', 'population'].forEach(r => {
          if (this.resources[r] < 0) this.resources[r] = 0;
        });

        // Research progress (per second)
        if (this.currentResearch) {
          const tech = this.research[this.currentResearch];
          tech.progress += rates.research / 6;
          if (tech.progress >= tech.cost) {
            tech.completed = true;
            tech.researching = false;
            tech.progress = tech.cost;
            this.resources.research -= tech.cost;
            this.showNotification(`Research completed: ${this.currentResearch}!`);
            this.currentResearch = null;
            this.applyResearchEffects();
            this.renderBuildings();
          }
        }

        // Advance day every 60 real seconds
        this.gameStats.day += 1 / 60;
        this.updateGameStats();

        // Update UI
        this.renderBuildings();    // Ensure affordability updates
        this.renderResearch();
        this.updateDisplay();
      }

      startGameLoop() {
        setInterval(() => this.gameLoop(), 1000);
      }

      showNotification(message) {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.classList.add('show');
        setTimeout(() => {
          notification.classList.remove('show');
        }, 3000);
      }
    }

    function switchTab(tabName) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      this.classList.add('active');
      document.getElementById(tabName + '-tab').classList.add('active');
    }

    const game = new StellarColony();
  </script>
</body>
</html>
