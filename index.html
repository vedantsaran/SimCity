<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Block Blast</n  <style>
    :root {
      --bg-gradient: linear-gradient(135deg, #1a1a2e, #16213e);
      --panel-bg: rgba(255,255,255,0.1);
      --panel-border: rgba(255,255,255,0.2);
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:Arial,sans-serif;
      background:var(--bg-gradient);
      color:#fff;
      display:flex; align-items:center; justify-content:center;
      min-height:100vh; overflow-x:hidden;
    }
    #game-container { display:flex; gap:30px; max-width:1200px; padding:20px; align-items:flex-start; }
    .panel { background:var(--panel-bg); backdrop-filter:blur(10px); border-radius:15px; padding:20px; border:1px solid var(--panel-border); }
    #score-panel { text-align:center; }
    #score-panel h2 { color:#FFD700; font-size:24px; margin-bottom:15px; }
    .score-item { font-size:18px; font-weight:bold; margin:10px 0; }
    #score { color:#4CFF4C; } #streak { color:#FF4CFF; } #best { color:#FFD700; }
    #controls { display:flex; flex-direction:column; gap:10px; }
    button {
      border:none; border-radius:10px;
      padding:12px 20px; font-size:16px; font-weight:bold;
      cursor:pointer; color:#fff;
      box-shadow:0 4px 15px rgba(0,0,0,0.3);
      transition:transform .15s,box-shadow .15s;
    }
    button:hover { transform:translateY(-1px); box-shadow:0 5px 18px rgba(0,0,0,0.35); }
    button:active { transform:translateY(0); }
    #btn-restart { background:linear-gradient(45deg,#4ecdc4,#44a08d); }
    #btn-mute { background:linear-gradient(45deg,#ffa726,#ff7043); }
    #board {
      display:grid; grid-template:repeat(8,1fr)/repeat(8,1fr);
      gap:2px; background:rgba(0,0,0,0.3);
      padding:10px; border-radius:15px;
      width:400px; height:400px;
      border:3px solid var(--panel-border);
      box-shadow:0 10px 30px rgba(0,0,0,0.5);
    }
    .cell {
      background:rgba(255,255,255,0.1);
      border:1px solid rgba(255,255,255,0.1);
      border-radius:4px;
      transition:background .1s,border .1s;
      position:relative;
    }
    .occupied { box-shadow:inset 0 0 10px rgba(0,0,0,0.3); }
    .drop-valid { background:rgba(76,255,76,0.3)!important; border:2px solid #4CFF4C; }
    .drop-invalid { background:rgba(255,76,76,0.3)!important; border:2px solid #FF4C4C; }
    .drop-clear { background:rgba(255,215,0,0.4)!important; border:2px solid #FFD700; }
    .clearing { animation:explode .25s ease-out forwards; }
    @keyframes explode {0%{transform:scale(1);opacity:1;}50%{transform:scale(1.2);opacity:.7;}100%{transform:scale(0);opacity:0;}}
    .color-red { background:linear-gradient(135deg,#FF4C4C,#C62828); }
    .color-green { background:linear-gradient(135deg,#4CFF4C,#2E7D32); }
    .color-blue { background:linear-gradient(135deg,#4C4CFF,#1565C0); }
    .color-yellow { background:linear-gradient(135deg,#FFD700,#F57C00); }
    .color-purple { background:linear-gradient(135deg,#FF4CFF,#7B1FA2); }
    .color-orange { background:linear-gradient(135deg,#FF8C42,#E65100); }
    #preview-area { min-width:200px; }
    #preview-area h3 { text-align:center; margin-bottom:20px; color:#FFD700; font-size:18px; }
    .preview-slot {
      background:rgba(0,0,0,0.2);
      border:2px dashed rgba(255,255,255,0.3);
      border-radius:10px;
      display:flex; align-items:center; justify-content:center;
      min-height:80px; cursor:grab;
      transition:transform .15s,border .15s;
    }
    .preview-slot:hover { transform:scale(1.02); border-color:#FFD700; }
    .selected { border-color:#4CFF4C; box-shadow:0 0 10px rgba(76,255,76,.5); }
    .dragging { opacity:.5; cursor:grabbing; }
    .preview-piece { display:grid; gap:2px; }
    .preview-block { width:20px; height:20px; border-radius:3px; box-shadow:0 2px 5px rgba(0,0,0,0.3); }
    .combo-flash, .score-popup { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); pointer-events:none; z-index:1000; }
    .combo-flash { font-size:48px; color:#FFD700; text-shadow:0 0 20px rgba(255,215,0,.8); animation:comboFlash .75s ease-out forwards; }
    .score-popup { font-size:36px; color:#4CFF4C; text-shadow:0 0 15px rgba(76,255,76,.7); animation:popupAnim .75s ease-out forwards; }
    @keyframes comboFlash {0%{opacity:0;transform:translate(-50%,-50%)scale(.5);}50%{opacity:1;transform:translate(-50%,-50%)scale(1.2);}100%{opacity:0;transform:translate(-50%,-50%)scale(1);}}
    @keyframes popupAnim {0%{opacity:0;transform:translate(-50%,-50%)scale(.5);}50%{opacity:1;transform:translate(-50%,-50%)scale(1.2);}100%{opacity:0;transform:translate(-50%,-50%)scale(1);}}
    #game-over-modal { position:fixed; inset:0; background:rgba(0,0,0,0.8); display:none; justify-content:center; align-items:center; z-index:2000; }
    .modal-content { background:var(--bg-gradient); border:2px solid #FFD700; border-radius:20px; padding:40px; text-align:center; box-shadow:0 20px 50px rgba(0,0,0,.8); max-width:400px; }
    .modal-content h2 { color:#FF4C4C; font-size:36px; margin-bottom:20px; text-shadow:0 0 10px rgba(255,76,76,.5); }
    .modal-content .final-score { font-size:24px; color:#4CFF4C; margin:20px 0; }
    .modal-content button { margin:10px; padding:15px 30px; font-size:18px; }
    @media(max-width:768px){ #game-container{flex-direction:column;align-items:center;gap:20px;padding:10px;} #board{width:320px;height:320px;} .panel{width:100%;max-width:320px;} .preview-slot{display:inline-block;width:30%;margin:5px;} }
    .placed-animation { animation:placeAnim .15s ease-out; }
    @keyframes placeAnim {0%{transform:scale(.9);}50%{transform:scale(1.05);}100%{transform:scale(1);} }
  </style>
</head>
<body>
  <div id="game-container">
    <div class="panel">
      <div id="score-panel">
        <h2>BLOCK BLAST</h2>
        <div class="score-item">Score: <span id="score">0</span></div>
        <div class="score-item">Streak: <span id="streak">0</span></div>
        <div class="score-item">Best: <span id="best">0</span></div>
      </div>
      <div id="controls">
        <button id="btn-restart">ðŸ”„ Restart</button>
        <button id="btn-mute">ðŸ”Š Sound: ON</button>
      </div>
    </div>
    <div id="board"></div>
    <div id="preview-area" class="panel">
      <h3>Next Pieces</h3>
      <div class="preview-slot" data-index="0"></div>
      <div class="preview-slot" data-index="1"></div>
      <div class="preview-slot" data-index="2"></div>
    </div>
  </div>
  <div id="game-over-modal">
    <div class="modal-content">
      <h2>Game Over!</h2>
      <div class="final-score">Final Score: <span id="final-score">0</span></div>
      <div id="new-best" style="display:none;color:#FFD700;font-size:18px;margin:10px 0;">ðŸŽ‰ New Best Score! ðŸŽ‰</div>
      <button id="btn-play-again">Play Again</button>
    </div>
  </div>
  <script>
  (function(){
    const SIZE=8;
    const SHAPES={single:[[0,0]],dominoH:[[0,0],[1,0]],dominoV:[[0,0],[0,1]],square:[[0,0],[1,0],[0,1],[1,1]],square3x3:[[0,0],[1,0],[2,0],[0,1],[1,1],[2,1],[0,2],[1,2],[2,2]],lShape:[[0,0],[0,1],[1,1]],lShapeFlip:[[0,1],[1,0],[1,1]],line3H:[[0,0],[1,0],[2,0]],line3V:[[0,0],[0,1],[0,2]],line4H:[[0,0],[1,0],[2,0],[3,0]],line4V:[[0,0],[0,1],[0,2],[0,3]],tShape:[[1,0],[0,1],[1,1],[2,1]],zShape:[[0,0],[1,0],[1,1],[2,1]],sShape:[[1,0],[2,0],[0,1],[1,1]],l4Up:[[0,0],[0,1],[0,2],[1,2]],l4Right:[[0,0],[1,0],[2,0],[2,1]],l4Down:[[1,0],[1,1],[1,2],[0,2]],l4Left:[[0,1],[1,1],[2,1],[0,0]],line5H:[[0,0],[1,0],[2,0],[3,0],[4,0]],line5V:[[0,0],[0,1],[0,2],[0,3],[0,4]],rect3x2:[[0,0],[1,0],[2,0],[0,1],[1,1],[2,1]],rect2x3:[[0,0],[0,1],[0,2],[1,0],[1,1],[1,2]]};
    const COLORS=['red','green','blue','yellow','purple','orange'];
    let board,upcoming,score=0,streak=0,best=0,placed=0,grace=0,selected=null,selIdx=-1,ctx,drag;
    // DOM refs
    const dom={board:document.getElementById('board'),slots:document.querySelectorAll('.preview-slot'),score:document.getElementById('score'),streak:document.getElementById('streak'),best:document.getElementById('best'),restart:document.getElementById('btn-restart'),mute:document.getElementById('btn-mute'),play:document.getElementById('btn-play-again'),modal:document.getElementById('game-over-modal'),final:document.getElementById('final-score'),newBest:document.getElementById('new-best')};
    // Audio
    function initAudio(){try{ctx=new(window.AudioContext||window.webkitAudioContext)();}catch{} }
    function play(freq,dur,type='sine'){if(!ctx||!soundOn)return;let o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.frequency.value=freq;o.type=type;g.gain.setValueAtTime(0.1,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+dur);o.start(ctx.currentTime);o.stop(ctx.currentTime+dur);}    
    // Utils
    const copyB=(b)=>b.map(r=>r.slice());
    function valid(shape,b,r,c){return shape.every(([dx,dy])=>{let x=r+dy,y=c+dx;return x>=0&&x<SIZE&&y>=0&&y<SIZE&&b[x][y]==null;});}
    function findLines(b){let rows=[],cols=[];for(let i=0;i<SIZE;i++){if(b[i].every(c=>c))rows.push(i);if(b.every(r=>r[i]!=null))cols.push(i);}return{rows,cols};}
    function clearLines(){let{rows,cols}=findLines(board),set=new Set();rows.forEach(r=>for(let c=0;c<SIZE;c++)set.add(r+','+c));cols.forEach(c=>for(let r=0;r<SIZE;r++)set.add(r+','+c));set.forEach(k=>{let[cellRow,cellCol]=k.split(',').map(Number),el=document.querySelector(`[data-row="${cellRow}"][data-col="${cellCol}"]`);el&&el.classList.add('clearing');});setTimeout(()=>{set.forEach(k=>{let[r,c]=k.split(',').map(Number);board[r][c]=null;});render();},250);return set.size;}
    function updateLines(){let{rows,cols}=findLines(board),cnt=rows.length+cols.length; if(cnt){let cleared=clearLines(),base=cleared*10,mul=cnt>=4?2.5:cnt>=3?2:cnt>=2?1.5:1;streak++;grace=3;let pts=Math.floor(base*mul)*streak;score+=pts;if(streak%5===0)score+=500;showPopup(pts,cnt,mul);updateUI();return;}if(grace-->0&&grace===0)streak=0;updateUI();}
    function showPopup(pts,cnt,mul){if(cnt>1){let c=document.createElement('div');c.className='combo-flash';c.textContent=`COMBO Ã—${mul}!`;document.body.append(c);setTimeout(()=>c.remove(),750);}let s=document.createElement('div');s.className='score-popup';s.textContent='+'+pts;document.body.append(s);setTimeout(()=>s.remove(),750);play(cnt>=3?880:cnt>=2?660:550,0.2,cnt>=3?'square':'sine');}
    // Board
    function initB(){board=Array(SIZE).fill().map(()=>Array(SIZE).fill(null));render();}
    function render(){dom.board.innerHTML='';for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++){let cell=document.createElement('div');cell.className='cell';cell.dataset.row=r;cell.dataset.col=c;if(board[r][c])cell.classList.add('occupied',`color-${board[r][c].color}`);dom.board.append(cell);} }
    // Pieces
    function randPiece(){let k=Object.keys(SHAPES)[Math.floor(Math.random()*Object.keys(SHAPES).length)],col=COLORS[Math.floor(Math.random()*COLORS.length)];return{shape:SHAPES[k],color:col,id:Date.now()+Math.random()};}
    function solvable(set,b){let perms=[[0,1,2],[0,2,1],[1,0,2],[1,2,0],[2,0,1],[2,1,0]];return perms.some(p=>{let temp=copyB(b);for(let idx of p){let piece=set[idx],placed=false;for(let r=0;r<SIZE&&!placed;r++)for(let c=0;c<SIZE&&!placed;c++){if(valid(piece.shape,temp,r,c)){piece.shape.forEach(([dx,dy])=>temp[r+dy][c+dx]={color:piece.color});let{rows,cols}=findLines(temp);rows.forEach(rr=>for(let cc=0;cc<SIZE;cc++)temp[rr][cc]=null);cols.forEach(cc=>for(let rr=0;rr<SIZE;rr++)temp[rr][cc]=null);placed=true;}}if(!placed)return false;}return true;});}
    function genPieces(){do{upcoming=[randPiece(),randPiece(),randPiece()];}while(!solvable(upcoming,board));placed=0;renderSlots();}
    function renderSlots(){dom.slots.forEach((slot,i)=>{slot.innerHTML='';slot.classList.remove('selected');delete slot.dataset.id;if(upcoming[i]){slot.dataset.id=upcoming[i].id;let bds=bounds(upcoming[i].shape),frag=document.createDocumentFragment();for(let y=0;y<bds.height;y++)for(let x=0;x<bds.width;x++){let blk=document.createElement('div');blk.className='preview-block';if(upcoming[i].shape.find(p=>p[0]===x+bds.minX&&p[1]===y+bds.minY))blk.classList.add(`color-${upcoming[i].color}`);else blk.style.opacity='0';fragment.append(blk);}let cont=document.createElement('div');cont.className='preview-piece';cont.style.gridTemplate=`repeat(${bds.height},1fr)/repeat(${bds.width},1fr)`;cont.appendChild(fragment);slot.append(cont);}});
    }
    // Place
    function placePiece(p,r,c){if(!valid(p.shape,board,r,c))return false;p.shape.forEach(([dx,dy])=>board[r+dy][c+dx]={color:p.color});render();p.shape.forEach(([dx,dy])=>{let cell=document.querySelector(`[data-row="${r+dy}"][data-col="${c+dx}"]`);cell&&cell.classList.add('placed-animation');setTimeout(()=>cell&&cell.classList.remove('placed-animation'),150);});play(440,0.1);return true;}
    // UI updates
    function updateUI(){if(score>best){best=score;localStorage.setItem('blockBlastBest',best);}dom.score.textContent=score;dom.streak.textContent=streak;dom.best.textContent=best;}
    function loadBest(){best=parseInt(localStorage.getItem('blockBlastBest'))||0;}
    function checkGameOver(){return upcoming.every(p=>!p||[...Array(SIZE)].some((_,r)=>[...Array(SIZE)].some((_,c)=>valid(p.shape,board,r,c))));}
    function end(){running=false;dom.final.textContent=score;if(score>best)dom.newBest.style.display='block';dom.modal.style.display='flex';play(220,0.5,'sawtooth');}
    // Events
    function setup(){dom.restart.onclick=reset;dom.play.onclick=reset;dom.mute.onclick=()=>{soundOn=!soundOn;dom.mute.textContent=soundOn?'ðŸ”Š Sound: ON':'ðŸ”‡ Sound: OFF';};
      dom.board.onclick=e=>{if(!running||!selected)return;let cell=e.target.closest('.cell');if(!cell)return;let r=+cell.dataset.row,c=+cell.dataset.col;if(placePiece(selected,r,c)){upcoming[selIdx]=null;placed++;renderSlots();updateLines();setTimeout(()=>{if((placed<3&&!upcoming.some(p=>p&&[...Array(SIZE)].some((_,r)=>[...Array(SIZE)].some((_,c)=>valid(p.shape,board,r,c)))))||(placed===3&&(!genPieces(),checkGameOver())))end();},300);}else{cell.classList.add('drop-invalid');setTimeout(()=>cell.classList.remove('drop-invalid'),150);}selected=null;};
      dom.slots.forEach(s=>s.onclick=()=>{if(!running||!upcoming[+s.dataset.index])return; if(selIdx===+s.dataset.index){s.classList.remove('selected');selected=null;selIdx=-1;}else{dom.slots.forEach(x=>x.classList.remove('selected'));s.classList.add('selected');selected=upcoming[selIdx=+s.dataset.index];}});
    }
    // Init
    let running=true,soundOn=true;
    function reset(){score=streak=placed=grace=0;running=true;dom.newBest.style.display='none';initB();genPieces();updateUI();dom.modal.style.display='none';}
    initAudio();loadBest();initB();genPieces();updateUI();setup();
  })();
  </script>
</body>
</html>
